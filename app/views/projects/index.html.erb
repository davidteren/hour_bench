<div style="max-width: 80rem; margin: 0 auto; padding: 0 1.5rem;">
  <!-- Header -->
  <div style="margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h1 style="font-size: 2.5rem; font-weight: 700; color: var(--color-text-primary); margin: 0; font-family: var(--font-family-primary);">Projects</h1>
        <p style="margin-top: 0.75rem; color: var(--color-text-secondary); font-size: 1.125rem;">Manage your projects and track progress</p>
      </div>
      <% if Current.user.can_manage_organization? && @organization && params[:client_id] %>
        <%= link_to new_organization_client_project_path(@organization, params[:client_id]),
            class: "btn btn-primary", style: "display: flex; align-items: center; gap: 0.5rem;" do %>
          <%= lucide_icon "plus", size: 16 %>
          New Project
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Filters -->
  <div class="card" style="margin-bottom: 1.5rem;">
    <div style="display: flex; gap: 1rem;">
      <% base_path = @organization && params[:client_id] ? organization_client_projects_path(@organization, params[:client_id]) : projects_path %>
      <%= link_to "All", base_path,
          style: "padding: 0.5rem 0.75rem; font-size: 0.875rem; font-weight: 500; border-radius: var(--radius-lg); text-decoration: none; #{params[:status].blank? ? 'background-color: var(--color-surface-secondary); color: var(--color-accent-primary);' : 'color: var(--color-text-secondary);'}",
          onmouseover: "#{params[:status].blank? ? '' : 'this.style.color=\'var(--color-text-primary)\''}",
          onmouseout: "#{params[:status].blank? ? '' : 'this.style.color=\'var(--color-text-secondary)\''}" %>
      <%= link_to "Active", "#{base_path}?status=active",
          style: "padding: 0.5rem 0.75rem; font-size: 0.875rem; font-weight: 500; border-radius: var(--radius-lg); text-decoration: none; #{params[:status] == 'active' ? 'background-color: var(--color-surface-secondary); color: var(--color-accent-primary);' : 'color: var(--color-text-secondary);'}",
          onmouseover: "#{params[:status] == 'active' ? '' : 'this.style.color=\'var(--color-text-primary)\''}",
          onmouseout: "#{params[:status] == 'active' ? '' : 'this.style.color=\'var(--color-text-secondary)\''}" %>
      <%= link_to "Completed", "#{base_path}?status=completed",
          style: "padding: 0.5rem 0.75rem; font-size: 0.875rem; font-weight: 500; border-radius: var(--radius-lg); text-decoration: none; #{params[:status] == 'completed' ? 'background-color: var(--color-surface-secondary); color: var(--color-accent-primary);' : 'color: var(--color-text-secondary);'}",
          onmouseover: "#{params[:status] == 'completed' ? '' : 'this.style.color=\'var(--color-text-primary)\''}",
          onmouseout: "#{params[:status] == 'completed' ? '' : 'this.style.color=\'var(--color-text-secondary)\''}" %>
      <%= link_to "On Hold", "#{base_path}?status=on_hold",
          style: "padding: 0.5rem 0.75rem; font-size: 0.875rem; font-weight: 500; border-radius: var(--radius-lg); text-decoration: none; #{params[:status] == 'on_hold' ? 'background-color: var(--color-surface-secondary); color: var(--color-accent-primary);' : 'color: var(--color-text-secondary);'}",
          onmouseover: "#{params[:status] == 'on_hold' ? '' : 'this.style.color=\'var(--color-text-primary)\''}",
          onmouseout: "#{params[:status] == 'on_hold' ? '' : 'this.style.color=\'var(--color-text-secondary)\''}" %>
    </div>
  </div>

  <!-- Projects Grid -->
  <% if @projects.any? %>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem;">
      <% @projects.each do |project| %>
        <div class="card-compact" style="transition: transform 0.2s ease;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
            <h3 style="font-size: 1.125rem; font-weight: 600; color: var(--color-text-primary); transition: color 0.2s ease; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; margin: 0;">
              <%= link_to project.name, (@organization && project.client ? organization_client_project_path(@organization, project.client, project) : project_path(project)), style: "text-decoration: none; color: inherit;", onmouseover: "this.style.color='var(--color-accent-primary)'", onmouseout: "this.style.color='var(--color-text-primary)'" %>
            </h3>
            <div class="status-indicator <%= case project.status
                when 'active' then 'status-running'
                when 'completed' then 'status-success'
                when 'on_hold' then 'status-warning'
                else 'status-stopped'
                end %>" style="margin-left: 1rem;">
              <%= project.status.humanize %>
            </div>
          </div>

          <% if project.description.present? %>
            <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
              <%= project.description %>
            </p>
          <% end %>

          <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.875rem; margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--color-text-secondary);">Client:</span>
              <span style="font-weight: 500; color: var(--color-text-primary);"><%= project.client.name %></span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--color-text-secondary);">Rate:</span>
              <span style="font-weight: 500; color: var(--color-text-primary);">$<%= project.hourly_rate %>/hr</span>
            </div>
            <% if project.budget %>
              <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--color-text-secondary);">Budget:</span>
                <span style="font-weight: 500; color: var(--color-text-primary);">$<%= number_with_delimiter(project.budget) %></span>
              </div>
            <% end %>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--color-text-secondary);">Total Hours:</span>
              <span style="font-weight: 500; color: var(--color-text-primary);"><%= (project.total_hours / 60.0).round(1) %>h</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--color-text-secondary);">Revenue:</span>
              <span style="font-weight: 500; color: var(--color-success);">$<%= number_with_delimiter(project.total_revenue.round(2)) %></span>
            </div>
          </div>

          <div style="display: flex; gap: 0.5rem; padding-top: 1rem; border-top: 1px solid var(--color-border-light);">
            <%= link_to "View", (@organization && project.client ? organization_client_project_path(@organization, project.client, project) : project_path(project)),
                class: "btn btn-secondary", style: "flex: 1; text-align: center;" %>
            <%= link_to "Log Time", new_project_time_log_path(project),
                class: "btn btn-primary", style: "flex: 1; text-align: center;" %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="card" style="text-align: center; padding: 3rem;">
      <div style="margin-bottom: 1rem; display: flex; justify-content: center;">
        <%= lucide_icon "clipboard-list", size: 48, style: "color: var(--color-text-tertiary);" %>
      </div>
      <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--color-text-primary); margin: 0 0 0.5rem 0;">No projects found</h3>
      <p style="color: var(--color-text-secondary); margin: 0 0 1.5rem 0;">Get started by creating a new project.</p>
      <% if Current.user.can_manage_organization? && @organization && params[:client_id] %>
        <%= link_to "New Project", new_organization_client_project_path(@organization, params[:client_id]),
            class: "btn btn-primary" %>
      <% end %>
    </div>
  <% end %>
</div>

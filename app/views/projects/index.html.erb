<div class="content-container">
  <!-- Header -->
  <div class="content-header">
    <div class="page-header-content">
      <div class="page-header-text">
        <h1 class="content-title">Projects</h1>
        <p class="content-subtitle">Manage your projects and track progress</p>
      </div>
      <% if Current.user.can_manage_organization? && @organization && params[:client_id] %>
        <div class="page-actions">
          <%= link_to new_organization_client_project_path(@organization, params[:client_id]),
              class: "btn btn-primary" do %>
            <%= lucide_icon "plus", size: 16 %>
            New Project
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Filters -->
  <div class="filter-bar">
    <div class="filter-buttons">
      <% base_path = @organization && params[:client_id] ? organization_client_projects_path(@organization, params[:client_id]) : projects_path %>
      <%= link_to "All", base_path,
          class: "filter-button #{'active' if params[:status].blank?}" %>
      <%= link_to "Active", "#{base_path}?status=active",
          class: "filter-button #{'active' if params[:status] == 'active'}" %>
      <%= link_to "Completed", "#{base_path}?status=completed",
          class: "filter-button #{'active' if params[:status] == 'completed'}" %>
      <%= link_to "On Hold", "#{base_path}?status=on_hold",
          class: "filter-button #{'active' if params[:status] == 'on_hold'}" %>
    </div>
  </div>

  <!-- Projects Grid -->
  <% if @projects.any? %>
    <div class="content-grid">
      <% @projects.each do |project| %>
        <div class="project-card">
          <div class="project-header">
            <h3 class="project-title">
              <%= link_to project.name, (@organization && project.client ? organization_client_project_path(@organization, project.client, project) : project_path(project)) %>
            </h3>
            <div class="status-indicator <%= case project.status
                when 'active' then 'project-status-active'
                when 'completed' then 'project-status-completed'
                when 'on_hold' then 'project-status-on-hold'
                else 'status-stopped'
                end %>">
              <%= project.status.humanize %>
            </div>
          </div>

          <% if project.description.present? %>
            <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
              <%= project.description %>
            </p>
          <% end %>

          <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.875rem; margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--color-text-secondary);">Client:</span>
              <span style="font-weight: 500; color: var(--color-text-primary);"><%= project.client.name %></span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--color-text-secondary);">Rate:</span>
              <span style="font-weight: 500; color: var(--color-text-primary);">$<%= project.hourly_rate %>/hr</span>
            </div>
            <% if project.budget %>
              <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--color-text-secondary);">Budget:</span>
                <span style="font-weight: 500; color: var(--color-text-primary);">$<%= number_with_delimiter(project.budget) %></span>
              </div>
            <% end %>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--color-text-secondary);">Total Hours:</span>
              <span style="font-weight: 500; color: var(--color-text-primary);"><%= (project.total_hours / 60.0).round(1) %>h</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--color-text-secondary);">Revenue:</span>
              <span style="font-weight: 500; color: var(--color-success);">$<%= number_with_delimiter(project.total_revenue.round(2)) %></span>
            </div>
          </div>

          <div style="display: flex; gap: 0.5rem; padding-top: 1rem; border-top: 1px solid var(--color-border-light);">
            <%= link_to "View", (@organization && project.client ? organization_client_project_path(@organization, project.client, project) : project_path(project)),
                class: "btn btn-secondary", style: "flex: 1; text-align: center;" %>
            <%= link_to "Log Time", new_project_time_log_path(project),
                class: "btn btn-primary", style: "flex: 1; text-align: center;" %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="card" style="text-align: center; padding: 3rem;">
      <div style="margin-bottom: 1rem; display: flex; justify-content: center;">
        <%= lucide_icon "clipboard-list", size: 48, style: "color: var(--color-text-tertiary);" %>
      </div>
      <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--color-text-primary); margin: 0 0 0.5rem 0;">No projects found</h3>
      <p style="color: var(--color-text-secondary); margin: 0 0 1.5rem 0;">Get started by creating a new project.</p>
      <% if Current.user.can_manage_organization? && @organization && params[:client_id] %>
        <%= link_to "New Project", new_organization_client_project_path(@organization, params[:client_id]),
            class: "btn btn-primary" %>
      <% end %>
    </div>
  <% end %>
</div>
